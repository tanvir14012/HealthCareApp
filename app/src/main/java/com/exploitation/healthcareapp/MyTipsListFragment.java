package com.exploitation.healthcareapp;


import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.support.v4.app.Fragment;
import android.support.v7.widget.DividerItemDecoration;
import android.support.v7.widget.LinearLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;

import com.futuremind.recyclerviewfastscroll.FastScroller;

import java.util.ArrayList;
import java.util.BitSet;
import java.util.List;


/**
 * A simple {@link Fragment} subclass.
 */
public class MyTipsListFragment extends Fragment {
    private RecyclerView mRecyclerView;
    private FastScroller fastScroller;
    private ReceipeAdapter mAdapter;
    private String catagoryName;
    public MyTipsListFragment() {
        // Required empty public constructor
    }

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        catagoryName = getActivity().getIntent().getStringExtra(MyTipsList.MYTIPS_CATAGORY_EXTRA);
        setHasOptionsMenu(true);
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {

        switch(item.getItemId()) {
            case R.id.mytips_list_plus :
            return true;

            case R.id.mytips_list_edit :
                return true;
            default:
                return super.onOptionsItemSelected(item);

        }
    }

    @Override
    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
        super.onCreateOptionsMenu(menu, inflater);
        inflater.inflate(R.menu.mytips_catagory_item_menu, menu);
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.list_receipe_fragment,container,false);
        mRecyclerView = (RecyclerView) view.findViewById(R.id.list_receipe_fragment_layout);
        fastScroller = (FastScroller) view.findViewById(R.id.fastscroll);

        mRecyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));
        /** getActivity() in a Fragment returns the Activity the Fragment is currently associated with. Recyclerview
         requires a LayoutManager to work **/
        mRecyclerView.addItemDecoration(new DividerItemDecoration(mRecyclerView.getContext(),DividerItemDecoration.VERTICAL));

        mAdapter = new ReceipeAdapter(getActivity());
        mRecyclerView.setAdapter(mAdapter);
        fastScroller.setRecyclerView(mRecyclerView);
        return  view;
    }
    private class ReceipeHolder extends RecyclerView.ViewHolder {
        private ImageView imageView;
        private TextView textView;
        private Receipe mReceipe;
        public ReceipeHolder( LayoutInflater inflater, ViewGroup container) {
            super(inflater.inflate(R.layout.list_receipe_item, container,false)); /** this
             way layout of list_receipt_item  is added to work with Recyclerview**/

            imageView =(ImageView) itemView.findViewById(R.id.imageView3); /* As the layout is inflated
            in super class, itemView(super class's View element) is used  */
            textView = (TextView) itemView.findViewById(R.id.textView3);

            itemView.setOnClickListener(new View.OnClickListener(){
                @Override
                public void onClick(View v) {
                    Intent intent = new Intent(getActivity(), SingleReceipeActivity.class);
                    intent.putExtra("receipeId", mReceipe.getId()); /** The extra is put on SingleReceipeActivity activity
                     and can be retrived from there **/
                    intent.putExtra("catagoryId",getActivity().getIntent().getIntExtra(ListReceipeFragmentActivity.INTENT_KEY,0));
                    startActivity(intent);
                }
            });

        }

        public void onBind(Receipe receipe) { /* User defined, modifies values of list_receipt_item
            when it's called from onBindViewHolder(..) of Adapter */
            imageView.setImageResource(getActivity().getResources().getIdentifier(receipe.getCaption(),"drawable",getActivity().getPackageName()));
            textView.setText(String.valueOf(receipe.getId()+1)+". " + getString(getActivity().getResources().getIdentifier(receipe.getName(),"string",getActivity().getPackageName())));
            mReceipe = receipe ; /**  Here we got the receipe obj associated with respective View, useful when a view is clicked */
        }
    }

    private class ReceipeAdapter extends RecyclerView.Adapter<MyTipsListFragment.ReceipeHolder> {
        private List<Receipe> receipeS;

        public ReceipeAdapter(Context context) {
            receipeS = new ArrayList<Receipe>();
        }

        @Override
        public ReceipeHolder onCreateViewHolder(ViewGroup parent, int viewType) {
            return new ReceipeHolder(LayoutInflater.from(getActivity()), parent);
        }

        @Override
        public void onBindViewHolder(ReceipeHolder holder, int position) {
            holder.onBind(receipeS.get(position));
        }

        @Override
        public int getItemCount() {
            return receipeS.size();
        }


    }

}
