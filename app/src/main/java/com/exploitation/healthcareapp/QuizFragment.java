package com.exploitation.healthcareapp;


import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.TextView;

import java.util.ArrayList;


/**
 * A simple {@link Fragment} subclass.
 */
public class QuizFragment extends Fragment {
    private TextView q,ans,info;
    private ImageView image;
    private Button btn,btn2;
    private RadioGroup rg;

    public QuizFragment() {
        // Required empty public constructor
    }
    public static QuizFragment newInstance(Quiz obj) {

        Bundle args = new Bundle();
        args.putString("question", obj.getQuestion());
        args.putInt("answer",obj.getAnswer());
        args.putString("imagelocation",obj.getImageLocation());
        args.putString("healthinfo",obj.getHealthInfo());
        args.putStringArrayList("options",obj.getOptions());

        QuizFragment fragment = new QuizFragment();
        fragment.setArguments(args);
        return fragment;
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View v = inflater.inflate(R.layout.fragment_quiz, container, false);

        q = (TextView) v.findViewById(R.id.question);
        image = (ImageView) v.findViewById(R.id.imageView);
        rg = (RadioGroup) v.findViewById(R.id.radioGroup);
        btn = (Button) v.findViewById(R.id.button);
        ans = (TextView) v.findViewById(R.id.result);
        info = (TextView) v.findViewById(R.id.info);
        btn2 = (Button) v.findViewById(R.id.button2);

        q.setText(getArguments().getString("question"));
        if(getArguments().getString("imagelocation") == null) {
            image.setVisibility(View.GONE);
        }
        else {
            image.setImageResource(getActivity().getResources().getIdentifier(getArguments().getString("imagelocation"), "drawable", getActivity().getPackageName()));
        }

        ArrayList<String> options = getArguments().getStringArrayList("options");
        LinearLayout.LayoutParams llp = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT);
        for(int i = 0; i<options.size(); i++) {
            RadioButton rb = new RadioButton(getActivity());
            rb.setId(i);
            rb.setText(options.get(i).toString());
            rg.addView(rb,i,llp);

        }
        btn.setOnClickListener(new View.OnClickListener(){
            @Override
            public void onClick(View v) {
                RadioButton checkedButton;
                int idx = getArguments().getInt("answer");

                if(rg.getCheckedRadioButtonId() != -1) {
                     checkedButton = (RadioButton) rg.findViewById(rg.getCheckedRadioButtonId());
                    if(checkedButton.getText().toString().equals(getArguments().getStringArrayList("options").get(idx))) {
                        ans.setText("Verdict : Correct !");
                    }
                    else {
                        ans.setText("Verdict : Wrong !");
                    }
                }
                else {
                    ans.setText("Verdict : Loser !");
                }
                info.setText(getArguments().getString("healthinfo"));
            }
        });

        btn2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                ( (QuizActivity) getActivity()).showNext();
            }
        });


        return v;
    }

}
